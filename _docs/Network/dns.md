---
title:  "DNS"
category: Network
date:   2019-12-06 02:16:59
comments: true
order: 2
---


도메인 이름 시스템(Domain Name System, DNS)은 인터넷 기반 가운데 하나지만 네트워킹 종사자를 제외한 대부분의 사람은 매일 일을 하고 이메일을 확인하고 스마트폰으로 한가한 시간을 보내면서도 자신이 DNS를 사용하고 있다는 걸 알지 못한다.

## DNS란 무엇인가
기본적으로 DNS는 숫자와 일치하는 이름 디렉터리다. 여기서 말하는 숫자는 컴퓨터가 상호 통신에 사용하는 IP 주소다. DNS에 대해 설명할 때 전화번호부에 빗대는 경우가 많은데, 전화번호부를 본 적이 있는 30세 이상의 사람에게는 효과적인 설명 방법이다.

전화번호부를 잘 모른다면, 그냥 사람 이름과 그 사람의 전화번호와 이메일 주소 등을 연결하는 스마트폰의 연락처 목록이라고 생각하면 된다. 이 연락처 목록에 세상 모든 사람의 이름을 집어넣으면 DNS가 된다.

인터넷 규모가 아주 작았던 시대에는 특정 IP 주소를 특정 컴퓨터와 일치시키는 일이 별로 어렵지 않았지만 인터넷이 커지고 더 많은 디바이스와 사람들이 참여하면서 상황이 바뀌었다. 모든 디바이스를 위한 디렉터리를 만들어야 한다는 점 외에도 사람은 다양한 사이트에 연결하기 위해 단어를 사용한다는 점도 고려해야 한다. 대부분의 사람에게 숫자 집합보다는 단어를 기억하기가 더 쉽기 때문이다. 지금도 여전히 브라우저에 IP 주소를 입력하는 방법으로 웹사이트에 접속할 수 있다.

## DNS 서버의 작동 원리
이름과 숫자를 연결하는 DNS 디렉터리는 인터넷의 어느 한 곳에 위치하는 것이 아니다. 인터넷 자체와 마찬가지로 이 디렉터리는 전 세계적으로 분산되어 정기적으로 상호 통신해 업데이트와 중복성을 제공하는 도메인 이름 서버에 저장된다. 2017년 말 현재 도메인 이름의 수는 3억 3,200만 개 이상이어서, 디렉터리 하나의 크기가 상당할 것이다.

각 명명된 사이트는 하나 이상의 IP 주소에 대응할 수 있다. 하나의 도메인 이름에 대응하는 IP 주소가 수백 개 이상인 사이트도 있다. 예를 들어 자신의 컴퓨터에서 www.google.com에 접속할 때 연결되는 서버는 다른 나라의 다른 사람이 자신의 브라우저에 똑같은 사이트 이름을 입력해 연결하는 서버와는 전혀 다른 서버일 가능성이 높다.

이 디렉터리가 분산될 수밖에 없는 또 다른 이유는 디렉터리가 하나의 위치에 있고 동시에 정보를 검색하는 수백만, 아마도 수십억 명의 사용자가 이를 공유할 경우 응답 시간이 매우 길어질 수밖에 없다는 점이다. 전화번호부 하나를 쓰기 위해 길게 줄을 서서 기다리는 셈이다.

DNS 정보는 다수의 서버에 저장되지만 클라이언트 컴퓨터에 로컬로 캐시도 된다. 일반적으로 사람들은 google.com을 하루에도 여러 번 사용한다. 사용자 컴퓨터에 이 정보를 저장하면 매번 컴퓨터가 DNS 이름 서버에 google.com의 IP 주소를 질의할 필요가 없으므로 IP 주소로 이름을 확인하기 위해 DNS 서버에 접속할 필요도 없다. 클라이언트를 인터넷에 연결하는 데 사용되는 라우터, 사용자 인터넷 서비스 제공업체(ISP)의 서버에서도 캐시가 사용된다. 캐시가 워낙 많이 사용되는 덕분에 실제로 DNS 이름 서버에 도달하는 질의의 수는 생각보다 훨씬 적다.

## DNS의 효율성 향상 방법
DNS는 신속하고 원활한 작동을 위해 계층적 구조로 이뤄진다. 설명을 위해 itworld.co.kr을 방문하려는 경우를 가정해 보자.

첫 IP 주소 요청이 일반적으로 ISP 또는 다른 공급업체가 운영하는 서버인 재귀적 리졸버(recursive resolver)에 도달한다. 재귀적 리졸버는 사이트의 이름(itworld.co.kr)을 IP 주소로 해석하기 위해 어느 DNS 서버에 물어야 하는지를 안다.

이 검색은 .com, .net, .org와 같은 최상위 도메인과 .kr(한국), .cn(중국), .uk(영국) 등의 모든 국가 도메인에 대한 모든 정보를 알고 있는 루트 서버(Root server)에 도달한다. 루트 서버는 세계 곳곳에 위치하므로 일반적으로 시스템은 지리적으로 가장 가까운 루트 서버로 사용자를 보낸다.

요청이 적절한 루트 서버에 도달하면 그 다음에는 최상위 도메인(top-level domain, TLD) 이름 서버로 이동한다. TLD는 2차 도메인, 즉 .com, .org. .net 앞에 사용하는 단어(예를 들어 itworld.co.kr의 경우 "itworld")에 대한 정보를 저장한다. 이후 요청은 사이트와 사이트의 IP 주소에 대한 정보를 갖고 있는 도메인 이름 서버로 간다. IP 주소가 발견되면 클라이언트로 반환되고, 이제 클라이언트는 이 IP 주소를 사용해 웹사이트를 방문할 수 있다. 이 모든 과정이 불과 몇 밀리초(ms)만에 수행된다.

DNS는 지난 30년 이상 사용된 만큼 대부분의 사람은 DNS를 당연히 있는 것으로 여긴다. 또한 DNS 시스템은 보안에 대한 고려 없이 구축됐기 때문에 해커들은 이를 최대한 악용해 다음과 같은 다양한 공격 수법을 고안했다.

## DNS 반사 공격
DNS 반사(reflection) 공격은 DNS 리졸버 서버에서 대량 메시지를 보내 피해자를 장악한다. 공격자는 찾을 수 있는 모든 개방된 DNS 리졸버에서 대용량 DNS 파일을 요청하며 이 과정에서 피해자의 스푸핑된 IP 주소를 사용한다. 리졸버가 응답하면 피해자는 요청하지 않은 막대한 양의 DNS 데이터를 받고 시스템은 마비된다.

## DNS 캐시 중독
DNS 캐시 중독(poisoning)은 사용자를 악성 웹 사이트로 유인할 수 있다. 공격자는 DNS에 잘못된 주소 레코드를 삽입해 잠재적 피해자가 중독된 사이트 가운데 하나의 주소 해결을 요청할 때 DNS가 공격자의 통제 하에 있는 다른 사이트의 IP 주소로 응답하도록 한다. 피해자가 일단 이런 가짜 사이트에 도달하면 유인해서 비밀번호를 입력하거나 악성코드를 다운로드하도록 한다.

## DNS 리소스 소진 공격
DNS 리소스 소진(resource exhaustion) 공격은 ISP의 DNS 인프라 작동을 방해해 ISP 고객의 인터넷 사이트 접속을 막는다. 공격자는 도메인 이름을 등록하고 피해자의 이름 서버를 도메인의 인증 서버로 사용한다. 따라서 재귀적 리졸버는 사이트 이름과 연결된 IP 주소를 제공하지 못할 경우 피해자의 이름 서버를 요청한다. 공격자는 도메인에 대한 대량의 요청을 생성해 존재하지 않는 하위 도메인으로 넘기고, 결과적으로 피해자의 이름 서버를 향해 해석 요청이 폭주해 시스템을 마비시킨다.

## DNSSec이란 무엇인가
DNS 보안 확장(DNS Security Extensions)은 DNS 조회에 관여하는 다양한 수준의 서버 간 통신을 더 안전하게 하는 것을 목표로 한다. DNS 시스템을 담당하는 국제인터넷주소관리기구(Internet Corporation for Assigned Names and Numbers, ICANN)가 고안했다.

ICANN은 공격자가 조회를 하이재킹할 여지를 제공하는 DNS 최상위, 2차 및 3차 디렉터리 서버 간 통신에 존재하는 취약점을 인식했다. 공격자는 하이재킹을 통해 정상 사이트 조회 요청에 악성 사이트의 IP 주소로 응답할 수 있다. 이런 사이트는 사용자에게 악성코드를 업로드하거나 피싱 또는 파밍 공격을 감행하기도 한다.

DNSSEC은 이 문제를 해결하기 위해 DNS 서버의 각 수준에서 요청에 디지털 서명을 하도록 한다. 이렇게 하면 최종 사용자가 보낸 요청을 공격자가 가로챌 수 없게 되고, 신뢰 체인을 형성해 조회의 각 단계에서 요청의 무결성을 검증할 수 있다.

또한 DNSSec은 도메인 이름이 존재하는지 여부를 확인하고 존재하지 않을 경우 사기 도메인이 도메인 이름 해석을 원하는 무고한 요청자에게 전달되지 않도록 한다.

더 많은 도메인 이름이 생성되고, 더 많은 디바이스가 사물인터넷 디바이스와 기타 "스마트" 시스템을 통해 네트워크에 참여하고, 더 많은 사이트가 IPv6으로 마이그레이션함에 따라 건강한 DNS 생태계 유지는 필수적인 일이 될 것이다. 빅데이터와 분석의 성장 역시 DNS 관리의 필요성을 증대시킨다.


## References
> * <a href="http://www.itworld.co.kr/news/108921#csidx68f31ee963649b0a28a08a0db7b0474 ">http://www.itworld.co.kr/news/108921#csidx68f31ee963649b0a28a08a0db7b0474<a>
